$("select.department").cssSelect();var designername=$('input[name="name"]'),department=$('select[name="department"]'),head=$('input[name="head"]'),signature=$('textarea[name="signature"]'),designconcept=$('textarea[name="designconcept"]'),phone=$('input[name="phone"]'),position=$('input[name="position"]'),qq=$('input[name="qq"]'),weixin=$('input[name="weixin"]'),representativework=$('input[name="representativework"]'),sortorder=$('input[name="sortorder"]'),workyear=$('input[name="workyear"]');var signatureCount=signature.siblings("div").find("span").text();signature.keyup(function(){wordCount($(this),signatureCount);});var designconceptCount=designconcept.siblings("div").find("span").text();designconcept.keyup(function(){wordCount($(this),designconceptCount);});designername.blur(function(){name_func($(this));});department.change(function(){depart_func($(this));});signature.blur(function(){textarea_func($(this),signatureCount);});designconcept.blur(function(){textarea_func($(this),designconceptCount);});position.blur(function(){position_func($(this));});qq.blur(function(){qq_func($(this));});phone.blur(function(){phone_func($(this));});weixin.blur(function(){weixin_func($(this));});representativework.blur(function(){work_func($(this));});sortorder.blur(function(){int_func($(this));});workyear.blur(function(){int_func($(this));});$('input[name="submit"]').click(function(){var $this=$(this);if($this.hasClass("submit-disable")){return false;}setTips($(this),"",true);var bool_name=name_func(designername),bool_depart=depart_func(department),bool_head=head_func(head),bool_position=position_func(position),bool_phone=phone_func(phone),bool_qq=qq_func(qq),bool_signature=textarea_func(signature,signatureCount),bool_designconcept=textarea_func(designconcept,designconceptCount),bool_weixin=weixin_func(weixin),bool_representativework=work_func(representativework);int_func(sortorder);int_func(workyear);if(bool_name&&bool_depart&&bool_head&&bool_position&&bool_qq&&bool_phone&&bool_signature&&bool_designconcept&&bool_weixin&&bool_representativework){var data={name:trimValue(designername.val()),head:trimValue(head.val()),position:trimValue(position.val()),dpid:parseInt(department.val()),signature:trimValue(signature.val()),workyear:parseInt(workyear.val()),representativework:trimValue(representativework.val()),designconcept:trimValue(designconcept.val()),phone:trimValue(phone.val()),qq:trimValue(qq.val()),weixin:trimValue(weixin.val()),sortorder:parseInt(sortorder.val())};$(this).siblings("i").html('<span class="doing">正在提交，请稍后……</span>');$(this).removeClass("submitable").addClass("submit-disable");$.post(postUrl,data,function(back){if(back.status==1){easyDialog.open({container:{header:"金标装饰-提醒窗口",content:"成功增加一位成员，你可以：<br />前往查看，或者继续添加成员！",yesFn:function(){window.location.href=window.location.href;},noFn:function(){window.location.href=back.redirecturl;}}});$("#easyDialogYesBtn").text("继续添加");$("#easyDialogNoBtn").text("查看成员表");}else{easyDialog.open({container:{content:back.data},autoClose:2000});}},"json");}else{setTips($(this),"表单数据还有错误，请检查！");return false;}});function name_func(o){var val=o.val();if(is_empty(val)){setTips(o,"成员姓名不能为空！");return false;}else{if(has_length_error(val,2,20)){setTips(o,"姓名长度为2-20个字，请检查！");return false;}else{setTips(o,"",true);return true;}}}function depart_func(o){var val=o.val();if(is_empty(val)){setTips(o,"请选择改成员所属部门！");return false;}else{if(is_all_numbers(val)&&val>0){setTips(o,"",true);return true;}else{setTips(o,"页面参数出现错误，请刷新页面重新添加！");return false;}}}function head_func(o){var val=o.val();var reg=/^#.*/;if(reg.test(val)){setTips(o,"请上传选中的图片");return false;}else{setTips(o,"",true);return true;}}function textarea_func(o,maxcount){maxcount=(maxcount==null)?200:maxcount;var val=trimValue(o.val());if(!is_empty(val)){if(has_length_error(val,0,maxcount)){setTips(o,"字数超限，请删减到"+maxcount+"字以内");return false;}else{setTips(o,"",true);return true;}}else{setTips(o,"建议填写，否则前端对应项将为空",true);return true;}}function position_func(o){var val=o.val();if(is_empty(val)){setTips(o,"请填写该成员的职位名称！");return false;}else{if(has_length_error(val,2,15)){setTips(o,"职位名称为2-15个字！");return false;}else{setTips(o,"",true);return true;}}}function qq_func(o){var val=o.val();if(is_empty(val)){setTips(o,"QQ建议填写，否则客户将无法联系此设计师！",true);return true;}else{if(is_qq(val)){setTips(o,"",true);return true;}else{setTips(o,"请填写正确的QQ号码！");return false;}}}function phone_func(o){var val=o.val();if(is_empty(val)){setTips(o,"",true);return true;}else{if(is_phone(val)){setTips(o,"",true);return true;}else{setTips(o,"请填写正确的手机号码！");return false;}}}function weixin_func(o){var val=o.val();if(is_empty(val)){setTips(o,"微信非必填！",true);return true;}else{if(is_weixin(val)){setTips(o,"",true);return true;}else{setTips(o,"请填写正确的微信号码！");return false;}}}function work_func(o){var val=o.val();if(is_empty(val)){setTips(o,"建议填写，否则前端代表作品栏将为空！",true);return true;}else{if(has_length_error(val,0,100)){setTips(o,"此项最多为100个字！");return false;}else{setTips(o,"",true);return true;}}}function int_func(o,defaultvalue){var val=o.val();if(is_empty(val)){o.val(defaultvalue);setTips(o,"将使用默认值"+defaultvalue,true);}else{if(!is_all_numbers(val)){o.val(defaultvalue);setTips(o,"请输入正整数");}else{setTips(o,"",true);}}return true;}function wordCount(o,totalNum){var nowLen=o.val().length;var thislen=totalNum-nowLen;if(thislen<0){thislen=" 已超出"+thislen;}o.siblings("div").find("span").text(thislen);}function setTips(o,tips,isDef){isDef=(isDef==null)?false:true;o.siblings("i").html("");if(isDef){if(""!==tips){var defTips=tips;}else{var defTips=o.siblings("i").attr("placeholder");}if(typeof defTips=="undefined"){defTips="通过校验";}o.siblings("i").text(defTips);}else{o.siblings("i").html('<i style="color: #DD2D28;font-size:15px;padding-right: 5px;" class="fa fa-exclamation-circle"></i><span style="color: #D31B26;">'+tips+"</span>");}}function file_change(e){document.getElementById("coverImg").value="#当前选择了:"+e;$(".select-cover").val("选择头像");$(".uploadBtn").removeClass("disabled");var $this=$("div#show-cover .img img");}function ajaxFileUpload(){var reg=/^#.*/;if($("#coverImg").val().replace(/\s/g,"").length<=0||!reg.test($("#coverImg").val().replace(/\s/g,""))){$(".cover i").html('<span style="color: #CB0303;">您还没选择上传文件</span>');return false;}if($(".uploadBtn").hasClass("disabled")){return false;}$(".select-cover").val("重新头像");$(".uploadBtn").addClass("disabled");$.ajaxFileUpload({url:headUploadUrl,secureuri:false,fileElementId:"coverImgFile",dataType:"json",success:function(data,status){if(data.status==0){$(".cover i").html('<span style="color: #CB0303;">'+data.data+"</span>");$(".cover i").fadeIn(200,function(){setTimeout(function(){$(".cover i").fadeOut(200,function(){$(this).html("");});},2000);});return false;}else{if(data.status==1){$("#coverImg").val(data.data);$("#coverImgFile").val("");$(".show_cover .img img").attr("src",data.data);}}},error:function(data,status,e){showMsg(e,"");}});return false;}