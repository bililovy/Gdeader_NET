$("#loginSubmit").click(function(){checklogin($(this));});$("body").keypress(function(e){if(e.keyCode==13){checklogin($("#loginSubmit"));}});function checklogin(o){var $this=o;if($this.hasClass("posting")){return false;}$("div#tips").text("").css("display","none");var $username=trimValue($('input[name="username"]').val());var $password=trimValue($('input[name="password"]').val());var $captcha=trimValue($('input[name="captcha"]').val());if(has_length_error($username,5,20)){showMsg("请输入正确的登录账户");}else{if(has_length_error($password,6,20)){showMsg("请输入登录密码");}else{if(is_empty($captcha)||has_length_error($captcha,5,5)||has_cn($captcha)){showMsg("请完整输入右侧验证码");}else{$this.addClass("posting");$this.val("正在登录");var $data={username:$username,password:hex_md5($password),captcha:$captcha};$.post($loginurl,$data,function(back){if(back.status==0){showMsg("登录失败，账户或密码不正确");getVerifyCode();$this.removeClass("posting");$this.val("登　　录");}else{if(back.status==2){showMsg("验证码输入不正确");getVerifyCode();$this.removeClass("posting");$this.val("登　　录");}else{if(back.status==1){showMsg("验证成功，正在进入系统…");$this.val("成功登录");setTimeout(function(){window.location.href=back.data;},1500);}else{showMsg(back.data);$this.removeClass("posting");$this.val("登　　录");}}}},"json");}}}}$("#captchaIMG").click(function(){getVerifyCode();});function getVerifyCode(){var $thissrc=$("#captchaIMG").attr("src");$("#captchaIMG").attr("src",$thissrc+"/"+Math.random());}function showMsg(tips){$("div#tips").text(tips).fadeIn(150,function(){$(this).animate({opacity:0},200,function(){$(this).animate({opacity:1},150);});});}